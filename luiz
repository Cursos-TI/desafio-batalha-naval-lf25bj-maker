// Importa a biblioteca para pegar o input do usuário
const prompt = require('prompt-sync')({ sigint: true });

// --- Variáveis Globais ---
const BOARD_SIZE = 10;
const board = [];
const ships = [
  { name: 'Submarino', size: 3 },
  { name: 'Cruzador', size: 4 },
];
let score = 0;
let shots = 0;

// --- Funções do Jogo ---

// Função para criar o tabuleiro
function createBoard() {
  for (let i = 0; i < BOARD_SIZE; i++) {
    board[i] = [];
    for (let j = 0; j < BOARD_SIZE; j++) {
      board[i][j] = '🌊'; // Água
    }
  }
}

// Função para posicionar os navios de forma aleatória
function placeShips() {
  for (const ship of ships) {
    let placed = false;
    while (!placed) {
      const row = Math.floor(Math.random() * BOARD_SIZE);
      const col = Math.floor(Math.random() * BOARD_SIZE);
      const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';

      let canPlace = true;
      for (let i = 0; i < ship.size; i++) {
        const newRow = direction === 'vertical' ? row + i : row;
        const newCol = direction === 'horizontal' ? col + i : col;

        if (newRow >= BOARD_SIZE || newCol >= BOARD_SIZE || board[newRow][newCol] !== '🌊') {
          canPlace = false;
          break;
        }
      }

      if (canPlace) {
        for (let i = 0; i < ship.size; i++) {
          const newRow = direction === 'vertical' ? row + i : row;
          const newCol = direction === 'horizontal' ? col + i : col;
          board[newRow][newCol] = '🚢'; // Navio
        }
        console.log(`Navio posicionado: ${ship.name}`);
        placed = true;
      }
    }
  }
}

// Função para exibir o tabuleiro
function displayBoard(showShips = false) {
  let header = '  ';
  for (let i = 0; i < BOARD_SIZE; i++) {
    header += i + ' ';
  }
  console.log(header);

  for (let i = 0; i < BOARD_SIZE; i++) {
    let rowStr = i + ' ';
    for (let j = 0; j < BOARD_SIZE; j++) {
      if (!showShips && board[i][j] === '🚢') {
        rowStr += '🌊' + ' ';
      } else {
        rowStr += board[i][j] + ' ';
      }
    }
    console.log(rowStr);
  }
}

// Função principal para jogar
function gameLoop() {
  while (score < 7) {
    console.clear();
    console.log('--- Batalha Naval ---');
    console.log(`Pontuação: ${score} | Tiros: ${shots}`);
    displayBoard();

    let row = parseInt(prompt('Digite a linha (0-9): '));
    let col = parseInt(prompt('Digite a coluna (0-9): '));
    shots++;

    if (isNaN(row) || isNaN(col) || row < 0 || row >= BOARD_SIZE || col < 0 || col >= BOARD_SIZE) {
      console.log('Coordenada inválida. Tente novamente.');
      continue;
    }

    if (board[row][col] === '🚢') {
      console.log('💥 Acertou!');
      board[row][col] = '💥';
      score++;
    } else if (board[row][col] === '🎯') {
      console.log('Você já tentou esta coordenada!');
    } else {
      console.log('💧 Errou!');
      board[row][col] = '🎯';
    }

    prompt('Pressione Enter para continuar...');
  }
  console.clear();
  console.log('--- Fim do Jogo ---');
  console.log('Parabéns! Você afundou todos os navios!');
  console.log(`Pontuação final: ${score} em ${shots} tiros.`);
  displayBoard(true);
}

// --- Iniciar o Jogo ---
createBoard();
placeShips();
gameLoop();
